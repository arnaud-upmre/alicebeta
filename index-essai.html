<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />

    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex" />
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex" />
    <meta name="theme-color" content="#0b1726" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
    
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <title>ALICE</title>
    <link rel="manifest" href="./manifest.webmanifest" />
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/icon-32.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="./icons/icon-192.png" />
    <link rel="apple-touch-icon" href="./icons/apple-touch-icon.png" />
    <link href="./vendor/maplibre/maplibre-gl.css" rel="stylesheet" />
    <link rel="stylesheet" href="./styles.css" />
    <style>
      .bouton-meteo-hdf {
        position: relative;
        overflow: hidden;
      }

      .bouton-meteo-hdf::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(145deg, rgba(15, 23, 42, 0.08), rgba(15, 23, 42, 0));
        pointer-events: none;
      }

      .meteo-hdf-pastilles {
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }

      .meteo-hdf-pastille {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 1px solid rgba(15, 23, 42, 0.35);
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.5);
      }

      .meteo-hdf-pastille.vert {
        background: #22c55e;
      }

      .meteo-hdf-pastille.jaune {
        background: #facc15;
      }

      .meteo-hdf-pastille.orange {
        background: #f97316;
      }

      .meteo-hdf-pastille.rouge {
        background: #dc2626;
      }

      .meteo-hdf-pastille.inconnu {
        background: #94a3b8;
      }

      .panneau-meteo-hdf {
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1350;
        width: min(90vw, 340px);
        max-height: min(70vh, 560px);
        display: none;
        border: 1px solid rgba(148, 163, 184, 0.35);
        border-radius: 14px;
        background: rgba(255, 255, 255, 0.97);
        box-shadow: 0 18px 46px rgba(15, 23, 42, 0.28);
        overflow: hidden;
      }

      .panneau-meteo-hdf.is-open {
        display: block;
      }

      .panneau-meteo-hdf-entete {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        padding: 10px 12px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
        background: linear-gradient(180deg, rgba(241, 245, 249, 0.9), rgba(248, 250, 252, 0.92));
      }

      .panneau-meteo-hdf-titre {
        margin: 0;
        font-size: 0.88rem;
        font-weight: 800;
        color: #0f172a;
      }

      .panneau-meteo-hdf-fermer {
        border: 0;
        border-radius: 8px;
        width: 28px;
        height: 28px;
        background: rgba(15, 23, 42, 0.08);
        color: #1e293b;
        font-size: 1.1rem;
        line-height: 1;
        cursor: pointer;
      }

      .panneau-meteo-hdf-contenu {
        padding: 10px 12px 12px;
      }

      .meteo-hdf-statut {
        margin: 0;
        font-size: 0.76rem;
        color: #475569;
      }

      .meteo-hdf-liste {
        margin: 10px 0;
        padding: 0;
        list-style: none;
        display: grid;
        gap: 8px;
        max-height: min(44vh, 340px);
        overflow: auto;
      }

      .meteo-hdf-item {
        border: 1px solid rgba(148, 163, 184, 0.25);
        border-radius: 10px;
        padding: 8px;
        background: rgba(248, 250, 252, 0.9);
      }

      .meteo-hdf-item-top {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .meteo-hdf-item-niveau {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        border: 1px solid rgba(15, 23, 42, 0.35);
        flex-shrink: 0;
      }

      .meteo-hdf-item-dept {
        margin: 0;
        font-size: 0.8rem;
        font-weight: 800;
        color: #0f172a;
      }

      .meteo-hdf-item-texte {
        margin: 5px 0 0 18px;
        font-size: 0.74rem;
        color: #334155;
        line-height: 1.35;
      }

      .meteo-hdf-refresh {
        width: 100%;
        border: 0;
        border-radius: 10px;
        padding: 8px 10px;
        background: rgba(2, 132, 199, 0.14);
        color: #075985;
        font-size: 0.76rem;
        font-weight: 800;
        cursor: pointer;
      }

      @media (max-width: 640px) {
        .panneau-meteo-hdf {
          width: min(94vw, 360px);
          max-height: min(72vh, 600px);
        }
      }
    </style>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4602CPKFWF"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4602CPKFWF');
    </script>
  </head>
  <body>
    <div id="map"></div>
    <div class="controle-recherche" id="controle-recherche">
      <label class="recherche-champ-wrap" for="champ-recherche">
        <img src="./alice.webp" alt="Logo ALICE" class="recherche-logo" onerror="this.style.display='none';" />
        <input
          id="champ-recherche"
          class="recherche-champ"
          type="search"
          autocomplete="off"
          placeholder="Rechercher un poste, appareil, acces..."
          aria-label="Rechercher un poste, un appareil ou un acces"
        />
      </label>
      <ul class="recherche-resultats" id="recherche-resultats" aria-label="Resultats de recherche"></ul>
    </div>
    <div class="info-vitesse-ligne" id="info-vitesse-ligne" aria-live="polite" aria-hidden="true">
      ‚ö†Ô∏è Vitesse affich√©e √† titre indicatif. Se r√©f√©rer aux documents r√©glementaires internes pour les vitesses de ligne applicables.
    </div>
    <div class="info-pk" id="info-pk" aria-live="polite" aria-hidden="true">
      üîç Zoomez pour afficher les PK.
    </div>

    <div class="controle-filtres" id="controle-filtres">
      <button
        class="bouton-filtres bouton-localisation-mobile"
        id="bouton-localisation-mobile"
        type="button"
        aria-label="Me localiser"
        title="Me localiser"
      >
        <svg class="icone-localisation-mobile" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 8.8A3.2 3.2 0 1 0 12 15.2 3.2 3.2 0 1 0 12 8.8z" />
          <path d="M20.5 11h-1.64a6.94 6.94 0 0 0-5.86-5.86V3.5a1 1 0 1 0-2 0v1.64A6.94 6.94 0 0 0 5.14 11H3.5a1 1 0 1 0 0 2h1.64a6.94 6.94 0 0 0 5.86 5.86v1.64a1 1 0 1 0 2 0v-1.64A6.94 6.94 0 0 0 18.86 13h1.64a1 1 0 1 0 0-2zM12 17a5 5 0 1 1 0-10 5 5 0 0 1 0 10z" />
        </svg>
      </button>
      <button
        class="bouton-filtres bouton-meteo-hdf"
        id="bouton-meteo-hdf"
        type="button"
        aria-label="Ouvrir les alertes m√©t√©o Hauts-de-France"
        title="Alertes m√©t√©o HDF"
        aria-expanded="false"
        aria-controls="panneau-meteo-hdf"
      >
        <span class="meteo-hdf-pastilles" aria-hidden="true">
          <span class="meteo-hdf-pastille inconnu" id="meteo-hdf-indicator"></span>
        </span>
      </button>
      <button
        class="bouton-filtres bouton-itineraire"
        id="bouton-itineraire"
        type="button"
        aria-label="Comparer deux postes"
        title="Comparer 2 postes"
      >
        <span class="icone-itineraire" aria-hidden="true">&lt;&gt;</span>
      </button>
      <a
        class="bouton-filtres bouton-tableau"
        id="bouton-tableau"
        href="./tableau.html"
        aria-label="Ouvrir le tableau blanc"
        title="Tableau blanc"
      >
        <svg class="icone-tableau" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4 4h7v7H4V4zm9 0h7v7h-7V4zM4 13h7v7H4v-7zm9 0h7v7h-7v-7z" />
        </svg>
      </a>
      <button
        class="bouton-filtres"
        id="bouton-filtres"
        type="button"
        aria-label="Afficher les filtres"
        aria-expanded="false"
      >
        <svg class="icone-burger" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M4 6h16v2H4V6zm0 5h16v2H4v-2zm0 5h16v2H4v-2z" />
        </svg>
      </button>

      <form class="menu-filtres" aria-label="Filtres de couches">
        <label class="option-filtre">
          <input type="checkbox" name="filtre-appareils" />
          <span>Appareils <span class="filtre-compteur" id="compteur-appareils">(0)</span></span>
        </label>
        <label class="option-filtre">
          <input type="checkbox" name="filtre-acces" />
          <span>Acces voiture <span class="filtre-compteur" id="compteur-acces">(0)</span></span>
        </label>
        <label class="option-filtre">
          <input type="checkbox" name="filtre-postes" />
          <span>Postes <span class="filtre-compteur" id="compteur-postes">(0)</span></span>
        </label>
        <label class="option-filtre">
          <input type="checkbox" name="filtre-pk" />
          <span>PK</span>
        </label>
        <label class="option-filtre">
          <input type="checkbox" name="filtre-pn" />
          <span>Passages a niveau</span>
        </label>
        <label class="option-filtre">
          <input type="checkbox" name="filtre-lignes" />
          <span>Ligne</span>
        </label>
        <label class="option-filtre">
          <input type="checkbox" name="filtre-vitesse-ligne" />
          <span>Vitesse de ligne</span>
        </label>
        <div class="menu-filtres-separateur" role="presentation"></div>
        <button class="bouton-filtres-legende" id="bouton-legende-filtres" type="button">L√©gende</button>
      </form>
    </div>
    <aside class="panneau-meteo-hdf" id="panneau-meteo-hdf" aria-hidden="true">
      <div class="panneau-meteo-hdf-entete">
        <h3 class="panneau-meteo-hdf-titre">Alertes m√©t√©o Hauts-de-France</h3>
        <button class="panneau-meteo-hdf-fermer" id="bouton-fermer-meteo-hdf" type="button" aria-label="Fermer les alertes m√©t√©o">√ó</button>
      </div>
      <div class="panneau-meteo-hdf-contenu">
        <p class="meteo-hdf-statut" id="meteo-hdf-statut">Chargement des alertes‚Ä¶</p>
        <ul class="meteo-hdf-liste" id="meteo-hdf-liste" aria-label="Alertes m√©t√©o Hauts-de-France"></ul>
        <button class="meteo-hdf-refresh" id="meteo-hdf-refresh" type="button">Actualiser les alertes</button>
      </div>
    </aside>

    <div class="controle-fonds" id="controle-fonds">
      <button
        class="bouton-fonds"
        id="bouton-fonds"
        type="button"
        aria-label="Choisir le fond de carte"
        aria-expanded="false"
      >
        <svg class="icone-couches" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M12 2 1 7l11 5 11-5-11-5zm0 9L1 6v2l11 5 11-5V6l-11 5zm0 4L1 10v2l11 5 11-5v-2l-11 5z" />
        </svg>
      </button>

      <form class="menu-fonds" role="radiogroup" aria-label="Fond de carte">
        <label class="option-fond">
          <input type="radio" name="fond" value="ignAuto" checked />
          <span>Auto Voyager + Satellite IGN</span>
        </label>
        <label class="option-fond">
          <input type="radio" name="fond" value="positron" />
          <span>Positron</span>
        </label>
        <label class="option-fond">
          <input type="radio" name="fond" value="voyager" />
          <span>Voyager</span>
        </label>
        <label class="option-fond">
          <input type="radio" name="fond" value="planIgn" />
          <span>Plan IGN</span>
        </label>
        <label class="option-fond">
          <input type="radio" name="fond" value="osm" />
          <span>OSM Standard</span>
        </label>
        <label class="option-fond">
          <input type="radio" name="fond" value="satelliteIgn" />
          <span>Satellite IGN</span>
        </label>
      </form>
    </div>

    <div class="panneau-mesure" id="panneau-mesure" aria-live="polite">
      <pre class="panneau-mesure-texte" id="panneau-mesure-texte"></pre>
    </div>
    <button class="bouton-sortie-mesure" id="bouton-sortie-mesure" type="button">
      ‚ùå Quitter le tra√ßage
    </button>
    <div class="menu-legende-carte" id="menu-legende-carte" aria-hidden="true">
      <div class="menu-legende-entete">
        <h2 class="menu-legende-titre">L√©gende</h2>
        <button class="menu-legende-fermer" id="bouton-fermer-legende" type="button" aria-label="Fermer la l√©gende">
          √ó
        </button>
      </div>
      <div class="menu-legende-section">
        <p class="menu-legende-section-titre">Objets carte</p>
        <ul class="menu-legende-liste">
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-acces"></span>Acc√®s voiture</li>
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-poste"></span>Postes</li>
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-pn"></span>Passages √† niveau</li>
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-hp"></span>Hors patrimoine</li>
        </ul>
      </div>
      <div class="menu-legende-section">
        <p class="menu-legende-section-titre">Couleurs appareils</p>
        <ul class="menu-legende-liste">
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-app-du"></span>Dispositif d'urgence</li>
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-app-si"></span>Interrupteur</li>
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-app-tt"></span>Transformateur</li>
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-app-t"></span>Sectionneur</li>
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-app-alim"></span>Alimentation</li>
          <li class="menu-legende-item"><span class="menu-legende-pastille pastille-app-autre"></span>Autres</li>
        </ul>
      </div>
    </div>

    <div class="menu-contextuel-carte" id="menu-contextuel-carte" role="menu" aria-hidden="true">
      <button class="menu-contextuel-item menu-contextuel-coord" id="ctx-coord" type="button">üìç 0.00000, 0.00000</button>
      <button class="menu-contextuel-item" id="ctx-share" type="button">üîó Partager la position</button>
      <button class="menu-contextuel-item" id="ctx-itin" type="button">üöó Itin√©raire vers ici</button>
      <div class="menu-contextuel-sousmenu" id="ctx-submenu-itin" aria-hidden="true">
        <button class="menu-contextuel-sousitem" id="ctx-gmaps" type="button">üöô Google Maps</button>
        <button class="menu-contextuel-sousitem" id="ctx-waze" type="button">üöô Waze</button>
        <button class="menu-contextuel-sousitem" id="ctx-apple" type="button">üöô Apple Plans</button>
      </div>
      <div class="menu-contextuel-separateur"></div>
      <button class="menu-contextuel-item" id="ctx-regle" type="button">üìè R√®gle / Tra√ßage</button>
      <div class="menu-contextuel-separateur"></div>
      <button class="menu-contextuel-item" id="ctx-gmaps-marker" type="button">üìå Google Maps</button>
      <button class="menu-contextuel-item" id="ctx-street" type="button">üåç Street View</button>
      <button class="menu-contextuel-item" id="ctx-imajnet" type="button">üõ£Ô∏è Imajnet</button>
      <div class="menu-contextuel-separateur"></div>
      <button class="menu-contextuel-item" id="ctx-add-appareil" type="button">üìç Ajouter un appareil ici</button>
    </div>
    <div
      class="modal-itineraire"
      id="modal-itineraire"
      role="dialog"
      aria-modal="true"
      aria-label="Calculer un trajet"
      aria-hidden="true"
    >
      <div class="modal-itineraire-carte">
        <div class="modal-itineraire-entete">
          <button class="modal-itineraire-fermer" id="modal-itineraire-fermer" type="button" aria-label="Fermer le calcul trajet">√ó</button>
          <h2 class="modal-itineraire-titre">Calculer un trajet</h2>
          <p class="modal-itineraire-sous-titre">S√©lectionnez un d√©part et une arriv√©e</p>
        </div>

        <div class="modal-itineraire-champs">
          <div class="modal-itineraire-champ">
            <label for="itineraire-depart">D√©part</label>
            <input id="itineraire-depart" type="search" autocomplete="off" placeholder="Rechercher un acc√®s" />
            <ul class="modal-itineraire-resultats" id="itineraire-depart-resultats" aria-label="R√©sultats d√©part"></ul>
          </div>
          <div class="modal-itineraire-champ">
            <label for="itineraire-arrivee">Arriv√©e</label>
            <input id="itineraire-arrivee" type="search" autocomplete="off" placeholder="Rechercher un acc√®s" />
            <ul class="modal-itineraire-resultats" id="itineraire-arrivee-resultats" aria-label="R√©sultats arriv√©e"></ul>
          </div>
        </div>

        <div class="modal-itineraire-etat" id="itineraire-etat">Choisissez un d√©part et une arriv√©e.</div>

        <section class="modal-itineraire-resume" id="itineraire-resume" aria-live="polite">
          <div class="modal-itineraire-resume-tete">
            <strong>R√©sum√© du trajet</strong>
            <span>Temps et distance estim√©s</span>
          </div>
          <div class="modal-itineraire-cartes">
            <div class="modal-itineraire-carte-kpi">
              <strong id="itineraire-distance">-</strong>
              <span>Distance</span>
            </div>
            <div class="modal-itineraire-carte-kpi">
              <strong id="itineraire-duree">-</strong>
              <span>Temps estim√©</span>
            </div>
          </div>
        </section>

        <div class="modal-itineraire-actions">
          <a class="popup-bouton-itineraire" id="itineraire-google" href="#" target="_blank" rel="noopener noreferrer">üó∫Ô∏è Google Maps</a>
          <a class="popup-bouton-itineraire" id="itineraire-apple" href="#" target="_blank" rel="noopener noreferrer">üçé Plans</a>
          <a class="popup-bouton-itineraire" id="itineraire-waze" href="#" target="_blank" rel="noopener noreferrer">üöó Waze</a>
        </div>

        <button class="modal-itineraire-toggle-carte" id="itineraire-toggle-carte" type="button" aria-expanded="false">
          Afficher la carte
        </button>
        <div class="modal-itineraire-apercu" id="itineraire-apercu" aria-hidden="true">
          <div id="itineraire-carte"></div>
        </div>
      </div>
    </div>
    <div class="modal-fiche" id="modal-fiche" role="dialog" aria-modal="true" aria-label="Fiche" aria-hidden="true">
      <div class="modal-fiche-carte">
        <button class="modal-fiche-partager" id="modal-fiche-partager" type="button" aria-label="Partager la fiche">
          <svg class="modal-fiche-partager-icone" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 3v12" />
            <path d="M8.5 6.5 12 3l3.5 3.5" />
            <path d="M6 10.5v7a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-7" />
          </svg>
        </button>
        <button class="modal-fiche-fermer" id="modal-fiche-fermer" type="button" aria-label="Fermer la fiche">√ó</button>
        <div class="modal-fiche-contenu maplibregl-popup-content" id="modal-fiche-contenu"></div>
      </div>
    </div>
    <div class="modal-apropos" id="modal-apropos" role="dialog" aria-modal="true" aria-label="√Ä propos" aria-hidden="true">
      <div class="modal-apropos-carte">
        <button class="modal-apropos-fermer" id="modal-apropos-fermer" type="button" aria-label="Fermer la fen√™tre √Ä propos">√ó</button>
        <div class="modal-apropos-entete">
          <img src="./alice.webp" alt="Logo ALICE" class="modal-apropos-logo" onerror="this.style.display='none';" />
          <h2 class="modal-apropos-titre">√Ä propos d'ALICE</h2>
        </div>
        <p class="modal-apropos-texte">
          ALICE est une <strong>A</strong>pplication interne de <strong>L</strong>ocalisation des <strong>I</strong>nstallations de <strong>C</strong>onduite <strong>E</strong>ALE, con√ßue pour faciliter le rep√©rage, l‚Äôanalyse et l‚Äôacc√®s aux informations d‚Äôexploitation pour les √©quipes de maintenance, travaux, groupe technique, r√©gulation et encadrement.
        </p>
        <p class="modal-apropos-texte">
          Application d√©velopp√©e par <a href="mailto:ALICEGrpO365@sncf.onmicrosoft.com">A. Debaecker</a>.
        </p>
        <h3 class="modal-apropos-sous-titre">Sources de donn√©es</h3>
        <ul class="modal-apropos-liste">
          <li>SNCF Open Data ‚Äî licence Open Database License (ODbL) (<a href="https://data.sncf.com/pages/licence/" target="_blank" rel="noopener noreferrer">d√©tails SNCF</a>).</li>
          <li>PK compl√©mentaires: extras-opendata-sncf-reseau (selon couches actives), licence ODbL-1.0.</li>
          <li>OpenStreetMap contributors: licence ODbL 1.0.</li>
          <li>Fond cartographique: CARTO, IGN, OpenRailwayMap (selon fond/couches).</li>
        </ul>
        <h3 class="modal-apropos-sous-titre">R√©utilisation</h3>
        <p class="modal-apropos-texte">¬© ALICE ‚Äì Donn√©es internes : r√©utilisation interdite sans autorisation.</p>
        <p class="modal-apropos-note">
          Les donn√©es Open Data tierces restent soumises √† leurs licences respectives.
        </p>
        <div class="modal-apropos-actions">
          <button class="modal-apropos-bouton-install" id="bouton-installer-pwa" type="button">
            Installer ALICE
          </button>
          <p class="modal-apropos-install-note" id="message-installer-pwa" aria-live="polite"></p>
        </div>
      </div>
    </div>
    <div
      class="modal-localisation"
      id="modal-localisation"
      role="dialog"
      aria-modal="true"
      aria-label="R√©sultats autour de vous"
      aria-hidden="true"
    >
      <div class="modal-localisation-carte">
        <div class="modal-localisation-entete">
          <button class="modal-localisation-fermer" id="modal-localisation-fermer" type="button" aria-label="Fermer la localisation">√ó</button>
          <h2 class="modal-localisation-titre">Autour de vous</h2>
          <p class="modal-localisation-sous-titre">R√©sultats proches de votre position actuelle</p>
          <div class="modal-localisation-etat" id="localisation-etat" aria-live="polite">Appuyez sur "Me localiser".</div>
        </div>
        <ul class="modal-localisation-resultats" id="localisation-resultats" aria-label="R√©sultats autour de vous"></ul>
      </div>
    </div>

    <script src="./vendor/maplibre/maplibre-gl.js"></script>
    <script src="./rss-numeros.js"></script>
    <script src="./code.js"></script>
    <script src="./recherche.js"></script>
    <script src="./meteo.js"></script>
    <script src="./app.js"></script>
    
  </body>
</html>
